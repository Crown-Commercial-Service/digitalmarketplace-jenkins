{% set packages = [
    "digitalmarketplace-api",
    "digitalmarketplace-search-api",
    "digitalmarketplace-admin-frontend",
    "digitalmarketplace-agreements",
    "digitalmarketplace-antivirus-api",
    "digitalmarketplace-api-docs",
    "digitalmarketplace-apiclient",
    "digitalmarketplace-aws",
    "digitalmarketplace-bad-words",
    "digitalmarketplace-brief-responses-frontend",
    "digitalmarketplace-briefs-frontend",
    "digitalmarketplace-buyer-frontend",
    "digitalmarketplace-cloudwatch-to-graphite",
    "digitalmarketplace-content-loader",
    "digitalmarketplace-credentials",
    "digitalmarketplace-deployment",
    "digitalmarketplace-docker-base",
    "digitalmarketplace-framework-application-guidance",
    "digitalmarketplace-frameworks",
    "digitalmarketplace-frontend-toolkit",
    "digitalmarketplace-functional-tests",
    "digitalmarketplace-g-cloud-service-submission",
    "digitalmarketplace-jenkins",
    "digitalmarketplace-maintenance",
    "digitalmarketplace-manual",
    "digitalmarketplace-performance-testing",
    "digitalmarketplace-prototype",
    "digitalmarketplace-router",
    "digitalmarketplace-runner",
    "digitalmarketplace-scripts",
    "digitalmarketplace-supplier-frontend",
    "digitalmarketplace-test-utils",
    "digitalmarketplace-user-frontend",
    "digitalmarketplace-utils",
    "digitalmarketplace-visual-regression"
]%}
---
{% for package in packages %}
- job:
    name: 'backup-{{ package }}'
    display-name: "Backup {{ package }} Github repo to AWS CodeCommit"
    project-type: freestyle
    description: "Backup repo: https://github.com/alphagov/{{ package }} to https://git-codecommit.eu-west-1.amazonaws.com/v1/repos/{{ package }}"
    properties:
      - build-discarder:
          days-to-keep: 20
          artifact-days-to-keep: 20
    scm:
      - git:
          url: git@github.com:alphagov/{{ package }}.git
          credentials-id: github_com_and_enterprise
          clean: true
    triggers:
      - pollscm:
          cron: "H/30 * * * *"
    wrappers:
      - ansicolor
    builders:
      - shell: |
          git remote add {{ package }}-aws-backup https://git-codecommit.eu-west-1.amazonaws.com/v1/repos/{{ package }}
          git config --local credential.helper '!aws codecommit credential-helper $@'
          git config --local credential.UseHttpPath true
          git push {{ package }}-aws-backup --mirror
{% endfor %}
