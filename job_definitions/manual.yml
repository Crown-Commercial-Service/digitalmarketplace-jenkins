---
- job:
    name: 'publish-manual'
    display: "Publish manual"
    project-type: freestyle
    description: "Automatically publish digitalmarketplace manual to gh pages."
    scm:
      - git:
          url: git@github.com:alphagov/digitalmarketplace-manual.git
          credentials-id: github_com_and_enterprise
          branches:
            - master
    triggers:
      - pollscm:
          cron: "H/2 * * * *"
    builders:
      - shell: |
          docker pull digitalmarketplace/manual || true
          docker build --pull -t digitalmarketplace/manual .
          docker push digitalmarketplace/manual

          docker run -it --rm \
            -v $(pwd):/app \
            digitalmarketplace/manual \
            make clean html
          
          make pages
