---
- job:
    name: 'publish-manual'
    display: "Publish manual"
    project-type: freestyle
    description: "Automatically publish digitalmarketplace manual to gh pages."
    scm:
      - git:
          url: git@github.com:alphagov/digitalmarketplace-manual.git
          credentials-id: github_com_and_enterprise
          branches:
            - master
    triggers:
      - pollscm:
          cron: "H/2 * * * *"
    builders:
      - shell: |
          [ -x /tmp/dm-manual-venv/bin/pip ] || virtualenv /tmp/dm-manual-venv
          . /tmp/dm-manual-venv/bin/activate

          pip install -r requirements.txt
          make clean html pages
