---
- name: Create Jenkins user group
  group: name=jenkins

- name: Create Jenkins user
  user: name=jenkins groups=jenkins createhome=no home=/var/lib/jenkins append=yes

- name: Format EBS volume
  filesystem: fstype=ext4 dev=/dev/xvdf

- name: Edit fstab and mount the volume
  mount: name={{ mount_dir }} src=/dev/xvdf opts=noatime fstype=ext4 state=mounted

- name: Create jenkins dir
  file: path={{ jenkins_home }} mode=755 state=directory owner=jenkins

- name: Create logs dir
  file: path={{ jenkins_logs_dir }} mode=755 state=directory owner=jenkins

- name: Set SSH ClientAliveInterval
  lineinfile:
    path: /etc/ssh/sshd_config
    line: "ClientAliveInterval 45"
    regexp: "^ClientAliveInterval (\\d*)$"

- name: Set SSH ClientAliveCountMax
  lineinfile:
    path: /etc/ssh/sshd_config
    line: "ClientAliveCountMax 80"
    regexp: "^ClientAliveCountMax (\\d*)$"

- name: Restart sshd
  service:
      name: 'ssh'
      state: 'restarted'

- set_fact:
    jobs_disabled: true  # when first setting up a box, disable the jobs!
